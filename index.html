<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BFR Calculator</title>
    <link rel="stylesheet" href="http://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
</head>
<body>
<div class="row" style="border: 10px solid #466d98; margin-top: 20px; margin-bottom: 20px;">
    <div class="medium-3 columns" style="padding: 15px;">
        <p><b>Select Index Type:</b></p>
        <div class="switch large" style="padding: 15px;">
            <input class="switch-input" id="primary-seondary" type="checkbox" name="indexswitch" checked="checked">
            <label class="switch-paddle" for="primary-seondary">
                <span class="show-for-sr">Select Index Type:</span>
                <span class="switch-active" aria-hidden="true">Prim</span>
                <span class="switch-inactive" aria-hidden="true">Sec</span>
            </label>
        </div>
        <p><b>Index Type:</b></p>
        <p id="index_type" class="stat">Primary</p>
    </div>
    <div class="medium-3 columns" style="padding: 15px;">
        <p><b>R (size total of fields)</b></p>
        <p id="record_total" class="stat">0</p>

        <p><b>bfr (blocking factor)</b></p>
        <p id="blocking_factor" class="stat">0</p>

        <p><b>b (total required blocks)</b></p>
        <p id="total_blocks" class="stat">0</p>
    </div>
    <div class="medium-6 columns" style="padding: 15px;">
        <p><b>Index Field</b></p>
        <p id="index_field_name" class="stat">NOT SET</p>

        <p><b>Index Field Size</b></p>
        <p id="index_field_size" class="stat">0</p>

        <p><b>Ri (Pointer Size + Index Field Size)</b></p>
        <p id="record_index" class="stat">0</p>
    </div>
</div>
<div class="row">
    <div class="medium-6 columns">
        <h1>Record Fields</h1>
        <p>Enter all of your record fields with size to calculate the record size <b>R</b></p>
        <form data-abide>
            <div>
                <div>
                    <label><b>Field Name</b>
                        <input id="name" required pattern="alpha_numeric" type="text" size="100" placeholder="Name">
                    </label>
                </div>
                <div>
                    <label><b>Field Size in Bytes</b>
                        <input id="size" required pattern="integer" type="text" size="100" placeholder="Size">
                    </label>
                </div>
                <div>
                    <button type="button" class="success button" id="add_record">Submit Field</button>
                </div>
            </div>

        </form>
        <table>
            <thead>
            <tr>
                <th width="200">Index Field</th>
                <th width="200">Field Name</th>
                <th width="200">Field Size (Bytes)</th>
                <th width="200">Remove Record</th>
            </tr>
            </thead>
            <tbody id="record">
            </tbody>
        </table>
    </div>
    <div class="medium-6 columns">
        <h1>Data</h1>
        <div>
            <label><b>B value (block size)</b>
                <input id="block_size" required pattern="integer" type="text" size="100" placeholder="Block Size">
            </label>
        </div>
        <div>
            <label><b>P value (block pointer size)</b>
                <input id="block_pointer_size" required pattern="integer" type="text" size="100" placeholder="Block Pointer Size">
            </label>
        </div>
        <div>
            <label><b>r value (total number or records)</b>
                <input id="record_count" required pattern="integer" type="text" size="100" placeholder="Record Count">
            </label>
        </div>
        <div>
            <button type="button" class="success button" id="calculate">Calculate</button>
        </div>

    </div>
</div>


<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="http://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.js"></script>
<script>
    $(document).foundation();

    //this will add 1 record to our table.  We will make sure that our name field is not empty and size is an integer value
    $("#add_record").click(function(){


        var name = $("#name").val();
        var size = $("#size").val();
        var recordTotal = parseInt($('#record_total').text());;

        //if size is an integer value and name is not blank, add to the records table, increase our running total, and change record_total with the current value
        if(Number.isInteger(parseInt(size)) && name !== ""){
            recordTotal += parseInt(size);
            $('#record').append('<tr><td><button type="button" class="success button index">Set Index</button></td><td>' + name + '</td><td>' + size + '</td><td><button type="button" class="alert button">Remove Record</button></td></tr>');
            $("#record_total").replaceWith('<p id="record_total">' + recordTotal + '</p>');
        } else{
            alert("Make sure all fields have values and Size field is an integer value.");
            console.log(name);
        }


    });

    //remove table row parent of the delete button clicked
    //was necessary to use .on for this function, as these fields are all added to the DOM after page load
    $("#record").on('click', '.alert', function(){


        var recordValue = parseInt($(this).parent().prev().text());
        var recordTotal = parseInt($('#record_total').text());
        var newTotal = recordTotal - recordValue;

        if(recordTotal > 0){
            $(this).parent().parent().remove();
            $("#record_total").replaceWith('<p id="record_total">' + newTotal + '</p>');
        }

    });

    /*calculate our necessary values based on given input
    R = total size of the record, total of the size of each record entry, B = block size in bytes, (we input this),
    r = total number of records (we input this), bfr (blocking factor) = floor ( B / R ), b (total required blocks) = ceiling( r / bfr )
    we do the necessary calculations and update the proper values on the page.
    */
    $("#calculate").click(function(){

        var indexSize = parseInt($('#index_field_size').text());
        var R = parseInt($('#record_total').text());
        var P = parseInt($('#block_pointer_size').val());
        var B = parseInt($('#block_size').val());
        var r = parseInt($('#record_count').val());
        var bfr = Math.floor( B/R );
        var b = Math.ceil( r/bfr );
        var Ri = P + indexSize;
        var bfri = Math.floor( B/Ri );

        //check that we have good integer values
        if(R > 0 && Number.isInteger(B) && Number.isInteger(r) && Number.isInteger(P) ){
            $("#blocking_factor").replaceWith('<p id="blocking_factor">' + bfr + '</p>');
            $("#total_blocks").replaceWith('<p id="total_blocks">' + b + '</p>');
            $('#record_index').replaceWith('<p id="record_index">' + Ri + '</p>');

        } else{
            alert("Please enter at least one record and ensure B, P, and r have valid values");
        }


    });

    //set the index field and value for calculations
    $("#record").on('click', '.index', function(){

        var fieldSize = parseInt($(this).parent().next().next().text());
        var fieldName = $(this).parent().next().text();

        $('#index_field_name').replaceWith('<p id="index_field_name">' + fieldName + '</p>');
        $("#index_field_size").replaceWith('<p id="index_field_size">' + fieldSize + '</p>');
    });

    $('input[name=indexswitch]').change(function(){
        var isOn = $('#primary-seondary').is(':checked');

        if(isOn === true){
            $("#index_type").replaceWith('<p id="index_type" class="stat">Primary</p>');
        }else{
            $("#index_type").replaceWith('<p id="index_type" class="stat">Secondary</p>');
        }
    });
</script>
</body>
</html>